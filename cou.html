<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rural Digital Education ‚Äî Courses</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Roboto+Slab:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4a8f3c;
      --primary-dark: #3a7230;
      --accent: #f5a623;
      --muted: #6c757d;
      --bg: #f5f7f5;
      --card: #fff;
      --radius: 10px;
      --shadow: 0 6px 18px rgba(0,0,0,0.08);
      --trans: all .25s ease;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      scroll-behavior: smooth;
    }
    
    body {
      margin: 0;
      font-family: Nunito, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: #213;
      line-height: 1.5;
    }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--accent);
      color: #111;
      padding: 8px;
      z-index: 10000;
      text-decoration: none;
      font-weight: bold;
    }
    
    .skip-link:focus {
      top: 0;
    }

    /* Header */
    header {
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      color: #fff;
      padding: 16px 20px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .brand i {
      font-size: 28px;
    }
    
    .brand h1 {
      margin: 0;
      font-family: Roboto Slab, serif;
      font-size: 20px;
    }
    
    nav ul {
      display: flex;
      gap: 18px;
      list-style: none;
      margin: 0;
      padding: 0;
      align-items: center;
    }
    
    nav a {
      color: rgba(255,255,255,0.95);
      text-decoration: none;
      font-weight: 600;
      padding: 8px 0;
      position: relative;
    }
    
    nav a:hover {
      color: var(--accent);
    }
    
    nav a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--accent);
      transition: width 0.3s ease;
    }
    
    nav a:hover::after,
    nav a:focus::after {
      width: 100%;
    }

    /* Language selector & add button */
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .lang-select {
      background: white;
      color: #222;
      padding: 6px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-family: inherit;
    }
    
    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      transition: var(--trans);
      font-family: inherit;
    }
    
    .btn-primary {
      background: var(--accent);
      color: #111;
    }
    
    .btn-primary:hover, .btn-primary:focus {
      background: #e69500;
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid rgba(255,255,255,0.15);
      color: white;
    }
    
    .btn-outline:hover, .btn-outline:focus {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Hero section */
    .hero {
      height: 320px;
      background-image: url("https://images.unsplash.com/photo-1546410531-bb4caa6b424d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80");
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,.45);
    }
    
    .hero-inner {
      position: relative;
      color: white;
      text-align: center;
      max-width: 900px;
      padding: 16px;
    }
    
    .hero h2 {
      font-family: Roboto Slab, serif;
      margin: 0 0 10px;
      font-size: 32px;
    }
    
    .hero p {
      opacity: .95;
      margin-bottom: 12px;
      font-size: 18px;
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 26px auto;
      padding: 0 16px;
    }
    
    .section-title {
      text-align: center;
      color: var(--primary-dark);
      font-family: Roboto Slab, serif;
      margin-bottom: 18px;
      position: relative;
      padding-bottom: 10px;
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background-color: var(--accent);
    }
    
    .courses-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    
    .filter-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    select.form-control {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: white;
      font-family: inherit;
    }
    
    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 18px;
    }
    
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: var(--trans);
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    .card-image {
      height: 140px;
      background: linear-gradient(90deg, #56ab2f, #a8e063);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .card-image i {
      font-size: 48px;
      color: white;
      opacity: .9;
    }
    
    .card-badge {
      position: absolute;
      right: 12px;
      top: 12px;
      background: var(--accent);
      color: #111;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 12px;
    }
    
    .card-content {
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
    }
    
    .card-title {
      font-size: 18px;
      margin: 0;
      color: var(--primary-dark);
      font-family: Roboto Slab, serif;
      line-height: 1.3;
    }
    
    .card-description {
      color: var(--muted);
      font-size: 14px;
      min-height: 48px;
      overflow: hidden;
      line-height: 1.5;
    }
    
    .card-meta {
      display: flex;
      gap: 12px;
      color: var(--muted);
      font-size: 13px;
    }
    
    .card-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .progress-container {
      margin-top: 6px;
    }
    
    .progress-bar {
      height: 8px;
      background: #eee;
      border-radius: 6px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary);
      width: 0%;
      transition: width 1s ease;
    }
    
    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: auto;
      flex-wrap: wrap;
    }
    
    .btn.small {
      padding: 8px 10px;
      font-weight: 700;
      border-radius: 8px;
      font-size: 13px;
    }
    
    footer {
      padding: 22px 10px;
      text-align: center;
      color: #fff;
      background: #213;
      margin-top: 26px;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.5);
      z-index: 1100;
    }
    
    .modal-backdrop.show {
      display: flex;
    }
    
    .modal-card {
      background: white;
      border-radius: 12px;
      max-width: 720px;
      width: 94%;
      padding: 18px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      max-height: 90vh;
      overflow: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .modal-header h3 {
      margin: 0;
    }
    
    .close-x {
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--muted);
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .close-x:hover, .close-x:focus {
      background-color: #f0f0f0;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .form-group {
      margin-bottom: 10px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 700;
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-family: inherit;
      transition: border-color 0.2s ease;
    }
    
    .form-control:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(74, 143, 60, 0.2);
    }
    
    .file-label {
      display: inline-block;
      padding: 10px;
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      width: 100%;
      text-align: center;
      cursor: pointer;
      transition: var(--trans);
    }
    
    .file-label:hover, .file-label:focus {
      border-color: var(--primary);
      background-color: rgba(74, 143, 60, 0.05);
    }
    
    .file-helper {
      font-size: 13px;
      color: var(--muted);
      margin-top: 6px;
    }

    /* Video modal */
    .video-modal .modal-card {
      max-width: 900px;
    }
    
    video {
      width: 100%;
      height: auto;
      border-radius: 8px;
      background: #000;
      display: block;
    }

    /* Loading spinner */
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(0,0,0,0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Teacher Dashboard */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .dashboard-card {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }
    
    .dashboard-card h3 {
      margin-top: 0;
      color: var(--primary-dark);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 10px;
    }
    
    .insight-list {
      list-style: none;
      padding: 0;
    }
    
    .insight-list li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .insight-list li:last-child {
      border-bottom: none;
    }

    /* Chatbot Styles */
    .chatbot-widget {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 320px;
      height: 420px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 1200;
    }
    
    .chat-header {
      background: var(--primary);
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      font-weight: bold;
      align-items: center;
    }
    
    .chat-body {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      font-size: 14px;
      color: #222;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .bot-msg, .user-msg {
      margin: 0;
      padding: 8px 10px;
      border-radius: 8px;
      max-width: 80%;
      line-height: 1.4;
    }
    
    .bot-msg {
      background: #f1f1f1;
      align-self: flex-start;
    }
    
    .user-msg {
      background: var(--primary);
      color: #fff;
      align-self: flex-end;
    }
    
    .chat-footer {
      display: flex;
      padding: 8px;
      gap: 6px;
      border-top: 1px solid #ddd;
      align-items: center;
    }
    
    .chat-footer input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-family: inherit;
    }
    
    .chat-footer button {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      cursor: pointer;
    }
    
    .floating-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      transition: var(--trans);
      color: #111;
    }
    
    .floating-btn:hover, .floating-btn:focus {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    /* Focus styles for accessibility */
    button:focus, select:focus, input:focus, a:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    @media (max-width: 720px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .courses-grid {
        grid-template-columns: 1fr;
      }
      
      .header-inner {
        padding: 0;
      }
      
      .hero h2 {
        font-size: 24px;
      }
      
      .hero p {
        font-size: 16px;
      }
      
      nav ul {
        gap: 12px;
      }
      
      nav a {
        font-size: 14px;
      }
      
      .controls {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .chatbot-widget {
        width: 90%;
        right: 5%;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <header>
    <div class="header-inner">
      <div class="brand">
        <i class="fas fa-graduation-cap" aria-hidden="true"></i>
        <h1>Rural Digital Education</h1>
      </div>

      <nav aria-label="Main navigation">
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#courses">Courses</a></li>
          <li><a href="#resources">Resources</a></li>
          <li><a href="#grades">Grades</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#analytics">Teacher Dashboard</a></li>
          <li><a href="#integration">SMS/Voice</a></li>
        </ul>
      </nav>
      
      <div class="controls">
        <select id="ui-lang" class="lang-select" aria-label="Select language">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
          <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        </select>

        <button id="open-add" class="btn btn-primary">
          <i class="fas fa-plus" aria-hidden="true"></i> Add Course
        </button>
      </div>
    </div>
  </header>

  <section class="hero" role="banner" aria-label="Education empowerment banner">
    <div class="hero-inner">
      <h2 data-t="hero_title">Empowering Rural Communities Through Digital Education</h2>
      <p data-t="hero_desc">Access quality educational resources and locally translated courses for learners of all ages.</p>
      <button class="btn btn-outline" id="explore-btn" data-t="explore_btn">Explore Courses</button>
    </div>
  </section>

  <main class="container" id="main-content">
    <h2 class="section-title" data-t="available_courses">Available Courses</h2>

    <div class="courses-header">
      <div class="filter-row">
        <select id="filter-level" class="form-control" aria-label="Filter by difficulty level">
          <option value="">-- Filter by Level --</option>
          <option value="Beginner">Beginner</option>
          <option value="Intermediate">Intermediate</option>
          <option value="Advanced">Advanced</option>
        </select>

        <select id="filter-lang" class="form-control" aria-label="Filter by language">
          <option value="">-- Filter by Language --</option>
          <option value="English">English</option>
          <option value="Hindi">Hindi</option>
          <option value="Kannada">Kannada</option>
          <option value="Telugu">Telugu</option>
        </select>

        <button id="clear-filters" class="btn small">Clear</button>
      </div>

      <div>
        <span id="courses-count" style="font-weight:700;color:var(--muted)"></span>
      </div>
    </div>

    <div class="courses-grid" id="courses-grid">
      <!-- cards rendered here -->
    </div>
  
    <!-- TEACHER ANALYTICS DASHBOARD -->
    <section id="analytics" class="container">
      <h2 class="section-title">üìä Teacher Analytics Dashboard</h2>
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3>Progress Overview</h3>
          <ul class="insight-list">
            <li>Average completion rate: <b>68%</b></li>
            <li>Most students struggled with <b>Digital Literacy - Week 2</b></li>
            <li>Average progress in <b>Sustainable Farming</b> = 72%</li>
            <li>Highest performing course: <b>Basic Mathematics</b> (84%)</li>
          </ul>
        </div>
        
        <div class="dashboard-card">
          <h3>Student Engagement</h3>
          <ul class="insight-list">
            <li>Average time spent: <b>42 minutes/day</b></li>
            <li>Most active time: <b>4-6 PM</b></li>
            <li>Course discussion participation: <b>38%</b></li>
            <li>Assignment submission rate: <b>76%</b></li>
          </ul>
        </div>
        
        <div class="dashboard-card">
          <h3>Recommendations</h3>
          <ul class="insight-list">
            <li>Suggested focus: <b>Hands-on practice modules</b></li>
            <li>Consider adding visual aids to <b>Week 2 Digital Literacy</b></li>
            <li>Schedule live Q&A session for <b>Sustainable Farming</b></li>
            <li>Provide additional practice problems for <b>Basic Mathematics</b></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Voice and SMS Integration Section -->
    <section class="container" id="integration">
      <h2 class="section-title">Voice and SMS Integration</h2>
      <div class="courses-grid">
        
        <!-- SMS & Voice Card -->
        <article class="card">
          <div class="card-image">
            <i class="fas fa-comment-dots"></i>
            <div class="card-badge">Feature</div>
          </div>
          <div class="card-content">
            <h3 class="card-title">Voice and SMS Integration</h3>
            <p class="card-description">
              In rural areas, many students may have limited internet access or use feature phones. 
              Consider integrating:
            </p>
            <ul style="color:#555; font-size:14px; margin-left:16px;">
              <li><b>SMS-based chatbot:</b> Students can ask questions or get help through SMS, which is more accessible.</li>
              <li><b>Voice interaction:</b> Use voice-enabled AI (e.g., Google Speech-to-Text, IBM Watson Speech) for students who may find it easier to speak queries rather than typing.</li>
            </ul>
          </div>
        </article>

        <!-- Chatbot Example Card -->
        <article class="card">
          <div class="card-image">
            <i class="fas fa-robot"></i>
            <div class="card-badge">Demo</div>
          </div>
          <div class="card-content">
            <h3 class="card-title">Chatbot Example</h3>
            <ol style="color:#555; font-size:14px; margin-left:16px;">
              <li><b>"progress": </b>"Your overall progress is 68%. You're doing great! Keep up the consistent work.",</li>
 	           <li><b>"help":</b> "I can help you with: checking your progress, finding resources, explaining concepts, and answering questions about your courses.",</li>
              <li><b>"resources": </b>"You can find additional resources in the 'Resources' section of the platform. Is there a specific topic you need resources for?",</li>
              <li><b>"hello":</b> "Hello! How can I help you with your learning today?",</li>
              <li><b>"thank": </b>"You're welcome! Is there anything else I can help you with?",</li>
             <li><b> "default": </b>"I'm not sure I understand. Could you rephrase that? I can help you with course content, progress tracking, and finding resources."</li>
            </ol>
          </div>
        </article>

      </div>
    </section>

    <!-- AI CHATBOT (Voice Assistant + Progress Tracker) -->
    <div id="chatbot-widget" class="chatbot-widget" aria-label="AI Tutor Assistant">
      <div class="chat-header">
        <span>AI Tutor Assistant</span>
        <button id="close-chat" aria-label="Close chat">&times;</button>
      </div>
      <div class="chat-body" id="chat-body">
        <div class="bot-msg">üëã Hi! I'm your AI tutor. Ask me anything about your lessons or progress.</div>
      </div>
      <div class="chat-footer">
        <input type="text" id="chat-input" placeholder="Type your question..." aria-label="Type your question"/>
        <button id="send-btn" aria-label="Send message">Send</button>
        <button id="voice-btn" aria-label="Use voice input"><i class="fas fa-microphone"></i></button>
      </div>
    </div>

    <!-- Floating Button -->
    <button id="open-chat" class="floating-btn" aria-label="Open AI tutor chat">
      <i class="fas fa-robot"></i>
    </button>
  </main>

  <footer>
    <div class="footer-content">
      <div>Rural Digital Education Platform &copy; <span id="yr"></span></div>
      <div style="font-size:13px;color:#d0d8d0;margin-top:6px" data-t="footer_desc">Bringing quality education to rural communities.</div>
    </div>
  </footer>

  <!-- ADD COURSE MODAL -->
  <div class="modal-backdrop" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="add-title">
      <div class="modal-header">
        <h3 id="add-title" data-t="modal_title">Add New Course</h3>
        <button class="close-x" id="close-modal" aria-label="Close">&times;</button>
      </div>

      <form id="add-form">
        <div class="form-row">
          <div class="form-group">
            <label for="title" data-t="label_title">Course Title</label>
            <input id="title" class="form-control" required aria-required="true" />
          </div>
          <div class="form-group">
            <label for="level" data-t="label_level">Difficulty Level</label>
            <select id="level" class="form-control" required aria-required="true">
              <option value="">Select level</option>
              <option>Beginner</option>
              <option>Intermediate</option>
              <option>Advanced</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="desc" data-t="label_desc">Description</label>
          <textarea id="desc" class="form-control" rows="3" required aria-required="true"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="lang" data-t="label_lang">Course Language</label>
            <select id="lang" class="form-control" required aria-required="true">
              <option value="">Select language</option>
              <option value="English">English</option>
              <option value="Hindi">Hindi</option>
              <option value="Kannada">Kannada</option>
              <option value="Telugu">Telugu</option>
            </select>
          </div>
          <div class="form-group">
            <label for="duration" data-t="label_duration">Duration (weeks)</label>
            <input id="duration" type="number" min="1" value="4" class="form-control" required aria-required="true" />
          </div>
        </div>

        <div class="form-group">
          <label data-t="label_materials">Course Materials</label>

          <div style="display:grid;gap:8px;">
            <label class="file-label" for="pdf">
              <i class="fas fa-file-pdf" aria-hidden="true"></i> <span data-t="upload_pdf">Upload PDF Notes</span>
            </label>
            <input id="pdf" type="file" accept="application/pdf" style="display:none" />

            <div class="file-helper" id="pdf-helper" data-t="no_file">No file selected</div>

            <label class="file-label" for="video">
              <i class="fas fa-video" aria-hidden="true"></i> <span data-t="upload_video">Upload Video Lesson</span>
            </label>
            <input id="video" type="file" accept="video/*" style="display:none" />

            <div class="file-helper" id="video-helper" data-t="no_file">No file selected</div>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px;">
          <button type="submit" class="btn btn-primary" data-t="add_btn">Add Course</button>
          <button type="button" class="btn" id="cancel" data-t="cancel_btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- VIDEO PLAY MODAL -->
  <div class="modal-backdrop" id="video-modal">
    <div class="modal-card video-modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3 id="video-title">Video Lesson</h3>
        <button class="close-x" id="close-video" aria-label="Close video">&times;</button>
      </div>
      <video id="player" controls aria-label="Video player"></video>
      <div style="margin-top:8px;font-size:13px;color:var(--muted)"><span id="video-name"></span></div>
    </div>
  </div>
  
  <script>
  (function(){
    // --- translations for UI strings (EN / HI / KN / TE) ---
    const T = {
      en: {
        hero_title: "Empowering Rural Communities Through Digital Education",
        hero_desc: "Access quality educational resources and locally translated courses for learners of all ages.",
        explore_btn: "Explore Courses",
        available_courses: "Available Courses",
        footer_desc: "Bringing quality education to rural communities.",
        modal_title: "Add New Course",
        label_title: "Course Title",
        label_level: "Difficulty Level",
        label_desc: "Description",
        label_lang: "Course Language",
        label_duration: "Duration (weeks)",
        label_materials: "Course Materials",
        upload_pdf: "Upload PDF Notes",
        upload_video: "Upload Video Lesson",
        no_file: "No file selected",
        add_btn: "Add Course",
        cancel_btn: "Cancel",
        enroll_now: "Enroll Now",
        view_notes: "View Notes",
        watch_video: "Watch Video",
        progress: "Progress",
        students: "students",
        course_weeks: "weeks",
        add_course_success: "Course added successfully!",
        clear_filters: "Clear"
      },
      hi: {
        hero_title: "‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£ ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§¨‡§®‡§æ‡§®‡§æ",
        hero_desc: "‡§∏‡§≠‡•Ä ‡§Ü‡§Ø‡•Å ‡§∏‡§Æ‡•Ç‡§π‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§®‡•Å‡§µ‡§æ‡§¶‡§ø‡§§ ‡§™‡§æ‡§†‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§î‡§∞ ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§∞‡§æ‡§è‡§Å‡•§",
        explore_btn: "‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç",
        available_courses: "‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§™‡§æ‡§†‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ",
        footer_desc: "‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£ ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§≤‡§æ‡§®‡§æ‡•§",
        modal_title: "‡§®‡§Ø‡§æ ‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
        label_title: "‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
        label_level: "‡§ï‡§†‡§ø‡§®‡§æ‡§à ‡§∏‡•ç‡§§‡§∞",
        label_desc: "‡§µ‡§ø‡§µ‡§∞‡§£",
        label_lang: "‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§≠‡§æ‡§∑‡§æ",
        label_duration: "‡§Ö‡§µ‡§ß‡§ø (‡§∏‡§™‡•ç‡§§‡§æ‡§π)",
        label_materials: "‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä",
        upload_pdf: "PDF ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
        upload_video: "‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§™‡§æ‡§† ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
        no_file: "‡§ï‡§ø‡§∏‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü",
        add_btn: "‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
        cancel_btn: "‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
        enroll_now: "‡§®‡§æ‡§Æ‡§æ‡§Ç‡§ï‡§® ‡§ï‡§∞‡•á‡§Ç",
        view_notes: "‡§®‡•ã‡§ü‡•ç‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç",
        watch_video: "‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç",
        progress: "‡§™‡•ç‡§∞‡§ó‡§§‡§ø",
        students: "‡§õ‡§æ‡§§‡•ç‡§∞",
        course_weeks: "‡§∏‡§™‡•ç‡§§‡§æ‡§π",
        add_course_success: "‡§ï‡•ã‡§∞‡•ç‡§∏ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ!"
      },
      kn: {
        hero_title: "‡≤°‡≤ø‡≤ú‡≤ø‡≤ü‡≤≤‡≥ç ‡≤∂‡≤ø‡≤ï‡≥ç‡≤∑‡≤£‡≤¶ ‡≤Æ‡≥Ç‡≤≤‡≤ï ‡≤ó‡≥ç‡≤∞‡≤æ‡≤Æ‡≥Ä‡≤£ ‡≤∏‡≤Æ‡≥Å‡≤¶‡≤æ‡≤Ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤¨‡≤≤‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≥Å‡≤µ‡≥Å‡≤¶‡≥Å",
        hero_desc: "‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤µ‡≤Ø‡≤∏‡≥ç‡≤∏‡≤ø‡≤® ‡≤Ö‡≤ß‡≥ç‡≤Ø‡≤Ø‡≤ï‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤≠‡≤æ‡≤∑‡≥Ü‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç‚Äå‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤Ç‡≤™‡≤®‡≥ç‡≤Æ‡≥Ç‡≤≤‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤í‡≤¶‡≤ó‡≤ø‡≤∏‡≤ø.",
        explore_btn: "‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç‚Äå‡≤ó‡≤≥ ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤®‡≥Ü",
        available_courses: "‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤∞‡≥Å‡≤µ ‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç‚Äå‡≤ó‡≤≥‡≥Å",
        footer_desc: "‡≤ó‡≥ç‡≤∞‡≤æ‡≤Æ‡≥Ä‡≤£ ‡≤∏‡≤Æ‡≥Å‡≤¶‡≤æ‡≤Ø‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤ó‡≥Å‡≤£‡≤Æ‡≤ü‡≥ç‡≤ü‡≤¶ ‡≤∂‡≤ø‡≤ï‡≥ç‡≤∑‡≤£.",
        modal_title: "‡≤π‡≥ä‡≤∏ ‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø",
        label_title: "‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç ‡≤∂‡≥Ä‡≤∞‡≥ç‡≤∑‡≤ø‡≤ï‡≥Ü",
        label_level: "‡≤ï‡≤∑‡≥ç‡≤ü‡≤¶ ‡≤Æ‡≤ü‡≥ç‡≤ü",
        label_desc: "‡≤µ‡≤ø‡≤µ‡≤∞‡≤£‡≥Ü",
        label_lang: "‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç ‡≤≠‡≤æ‡≤∑‡≥Ü",
        label_duration: "‡≤Ö‡≤µ‡≤ß‡≤ø (‡≤µ‡≤æ‡≤∞‡≤ó‡≤≥‡≥Å)",
        label_materials: "‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç ‡≤µ‡≤∏‡≥ç‡≤§‡≥Å‡≤ó‡≤≥‡≥Å",
        upload_pdf: "PDF ‡≤®‡≥ã‡≤ü‡≥ç‡≤∏‡≥ç ‡≤Ö‡≤™‡≥ç‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø",
        upload_video: "‡≤µ‡≥Ä‡≤°‡≤ø‡≤Ø‡≥ä ‡≤™‡≤æ‡≤† ‡≤Ö‡≤™‡≥ç‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤ø",
        no_file: "‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥á ‡≤´‡≥à‡≤≤‡≥ç ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø‡≤≤‡≥ç‡≤≤",
        add_btn: "‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤ø",
        cancel_btn: "‡≤∞‡≤¶‡≥ç‡≤¶‡≥Å‡≤Æ‡≤æ‡≤°‡≤ø",
        enroll_now: "‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø",
        view_notes: "‡≤®‡≥ã‡≤ü‡≥ç‡≤∏‡≥ç ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø",
        watch_video: "‡≤µ‡≥Ä‡≤°‡≤ø‡≤Ø‡≥ä ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø",
        progress: "‡≤™‡≥ç‡≤∞‡≤ó‡≤§‡≤ø",
        students: "‡≤µ‡≤ø‡≤¶‡≥ç‡≤Ø‡≤æ‡≤∞‡≥ç‡≤•‡≤ø‡≤ó‡≤≥‡≥Å",
        course_weeks: "‡≤µ‡≤æ‡≤∞‡≤ó‡≤≥‡≥Å",
        add_course_success: "‡≤ï‡≥ã‡≤∞‡≥ç‡≤∏‡≥ç ‡≤Ø‡≤∂‡≤∏‡≥ç‡≤µ‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü!"
      },
      te: {
        hero_title: "‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡±Ä‡∞£ ‡∞∏‡∞Ç‡∞ò‡∞æ‡∞≤‡∞®‡±Å ‡∞∏‡∞æ‡∞ß‡∞ø‡∞ï‡∞æ‡∞∞‡∞§ ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç",
        hero_desc: "‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞Ø‡∞∏‡±Å‡∞≤ ‡∞Ø ‡∞µ‡∞ø‡∞®‡∞æ‡∞Ø‡∞ï‡±Å‡∞≤‡∞ï‡±Å ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞Ö‡∞®‡±Å‡∞µ‡∞æ‡∞¶‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å‡∞≤‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞Æ‡±à‡∞® ‡∞µ‡∞®‡∞∞‡±Å‡∞≤‡±Å ‡∞Ö‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        explore_btn: "‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å‡∞≤‡∞®‡±Å ‡∞Ö‡∞®‡±ç‡∞µ‡±á‡∞∑‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
        available_courses: "‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞â‡∞®‡±ç‡∞® ‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å‡∞≤‡±Å",
        footer_desc: "‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡±Ä‡∞£ ‡∞∏‡∞Æ‡±Å‡∞¶‡∞æ‡∞Ø‡∞æ‡∞≤‡∞ï‡±Å ‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞Æ‡±à‡∞® ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞®‡±Å ‡∞Ö‡∞Ç‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç.",
        modal_title: "‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
        label_title: "‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å ‡∞∂‡±Ä‡∞∞‡±ç‡∞∑‡∞ø‡∞ï",
        label_level: "‡∞ï‡∞∑‡±ç‡∞ü‡∞Ç ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡∞ø",
        label_desc: "‡∞µ‡∞∞‡±ç‡∞£‡∞®",
        label_lang: "‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å ‡∞≠‡∞æ‡∞∑",
        label_duration: "‡∞ï‡∞æ‡∞≤‡∞Ç (‡∞µ‡∞æ‡∞∞‡∞æ‡∞≤‡±Å)",
        label_materials: "‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å ‡∞∏‡∞æ‡∞Æ‡∞ó‡±ç‡∞∞‡∞ø",
        upload_pdf: "PDF ‡∞®‡±ã‡∞ü‡±ç‡∞∏‡±ç ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        upload_video: "‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã ‡∞™‡∞æ‡∞†‡∞Ç ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        no_file: "‡∞è ‡∞´‡±à‡∞≤‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞¨‡∞°‡∞≤‡±á‡∞¶‡±Å",
        add_btn: "‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
        cancel_btn: "‡∞∞‡∞¶‡±ç‡∞¶‡±Å",
        enroll_now: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
        view_notes: "‡∞®‡±ã‡∞ü‡±ç‡∞∏‡±ç ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø",
        watch_video: "‡∞µ‡±Ä‡∞°‡∞ø‡∞Ø‡±ã ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø",
        progress: "‡∞™‡±Å‡∞∞‡±ã‡∞ó‡∞§‡∞ø",
        students: "‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡±Å‡∞≤‡±Å",
        course_weeks: "‡∞µ‡∞æ‡∞∞‡∞æ‡∞≤‡±Å",
        add_course_success: "‡∞ï‡±ã‡∞∞‡±ç‡∞∏‡±Å ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø!"
      }
    };

    // DOM refs
    const uiLang = document.getElementById('ui-lang');
    const tNodes = document.querySelectorAll('[data-t]');
    const openAddBtn = document.getElementById('open-add');
    const modal = document.getElementById('modal');
    const closeModalBtn = document.getElementById('close-modal');
    const cancelBtn = document.getElementById('cancel');
    const addForm = document.getElementById('add-form');
    const pdfInput = document.getElementById('pdf');
    const videoInput = document.getElementById('video');
    const pdfHelper = document.getElementById('pdf-helper');
    const videoHelper = document.getElementById('video-helper');
    const coursesGrid = document.getElementById('courses-grid');
    const filterLevel = document.getElementById('filter-level');
    const filterLang = document.getElementById('filter-lang');
    const clearFilters = document.getElementById('clear-filters');
    const coursesCount = document.getElementById('courses-count');
    const videoModal = document.getElementById('video-modal');
    const player = document.getElementById('player');
    const videoTitle = document.getElementById('video-title');
    const videoName = document.getElementById('video-name');
    const closeVideo = document.getElementById('close-video');
    const yrSpan = document.getElementById('yr');

    const STORAGE_KEY = 'rurallearn_courses_v1';
    let courses = [];

    // small helper: safe base64 read of a file (returns promise)
    function fileToBase64(file) {
      return new Promise((res, rej) => {
        const fr = new FileReader();
        fr.onload = () => res(fr.result);
        fr.onerror = () => rej(new Error('read error'));
        fr.readAsDataURL(file);
      });
    }

    // limit for storing files in localStorage (bytes). localStorage usually limited to ~5-10MB.
    const MAX_STORE_BYTES = 2 * 1024 * 1024; // 2 MB

    // translate UI function
    function applyTranslations(lang) {
      const dict = T[lang] || T.en;
      tNodes.forEach(n => {
        const key = n.getAttribute('data-t');
        if (dict[key]) n.textContent = dict[key];
      });
      // update any dynamic helpers
      updateCourseCount();
    }

    // load courses from localStorage
    function loadCourses() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        courses = raw ? JSON.parse(raw) : defaultCourses();
      } catch (e) {
        console.warn('failed load courses', e);
        courses = defaultCourses();
      }
    }

    // default sample courses
    function defaultCourses(){
      return [
        {
          id: genId(),
          title: "Sustainable Farming Techniques",
          desc: "Modern sustainable farming practices that increase yield while protecting the environment.",
          level: "Beginner",
          lang: "English",
          duration: 4,
          progress: 75,
          students: 128,
          pdf: null,
          video: null,
          createdAt: Date.now()
        },
        {
          id: genId(),
          title: "Digital Literacy for All Ages",
          desc: "Master essential computer skills, internet usage, and online safety practices.",
          level: "Intermediate",
          lang: "English",
          duration: 6,
          progress: 30,
          students: 89,
          pdf: null,
          video: null,
          createdAt: Date.now()
        },
        {
          id: genId(),
          title: "Basic Mathematics",
          desc: "Learn fundamental math concepts from arithmetic to basic algebra.",
          level: "Beginner",
          lang: "Hindi",
          duration: 8,
          progress: 84,
          students: 156,
          pdf: null,
          video: null,
          createdAt: Date.now()
        }
      ];
    }

    function saveCourses(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(courses));
      }catch(e){
        console.warn('Could not save courses (storage full?)', e);
        // Try to clear some space by removing large media files
        courses.forEach(c => {
          if (c.pdf && c.pdf.isBase64) c.pdf = null;
          if (c.video && c.video.isBase64) c.video = null;
        });
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(courses));
          alert("Storage space was low. Some media files were removed to save space.");
        } catch (e2) {
          alert("Error saving courses. Storage might be full. Try removing some courses.");
        }
      }
    }

    function genId(){ return 'c_'+Math.random().toString(36).slice(2,9); }

    // render a single card
    function renderCard(course){
      const card = document.createElement('article');
      card.className = 'card';
      card.dataset.level = course.level;
      card.dataset.lang = course.lang;
      card.innerHTML = `
        <div class="card-image">
          <i class="fas fa-book" aria-hidden="true"></i>
          <div class="card-badge">${escapeHtml(course.level)}</div>
        </div>
        <div class="card-content">
          <h3 class="card-title">${escapeHtml(course.title)}</h3>
          <p class="card-description">${escapeHtml(course.desc)}</p>
          <div class="card-meta">
            <div class="card-meta-item"><i class="far fa-clock" aria-hidden="true"></i><span>${course.duration} ${getT('course_weeks')}</span></div>
            <div class="card-meta-item"><i class="fas fa-users" aria-hidden="true"></i><span>${course.students} ${getT('students')}</span></div>
            <div class="card-meta-item"><i class="fas fa-language" aria-hidden="true"></i><span>${course.lang}</span></div>
          </div>
          <div class="progress-container">
            <div class="progress-header"><span>${getT('progress')}</span><span>${course.progress || 0}%</span></div>
            <div class="progress-bar"><div class="progress-fill" style="width:${(course.progress||0)}%"></div></div>
          </div>
          <div class="card-actions">
            <button class="btn small btn-primary enroll-btn">${getT('enroll_now')}</button>
          </div>
        </div>
      `;

      // attach materials buttons if exist
      const actions = card.querySelector('.card-actions');

      if(course.pdf){
        const a = document.createElement('a');
        a.href = course.pdf.isBase64 ? course.pdf.data : course.pdf.url;
        a.target = "_blank";
        a.rel = "noopener";
        a.className = 'btn small btn-outline';
        a.innerHTML = `<i class="fas fa-file-pdf" aria-hidden="true"></i> ${getT('view_notes')}`;
        actions.prepend(a);
      }

      if(course.video){
        const vbtn = document.createElement('button');
        vbtn.className = 'btn small btn-outline';
        vbtn.type = 'button';
        vbtn.innerHTML = `<i class="fas fa-video" aria-hidden="true"></i> ${getT('watch_video')}`;
        vbtn.addEventListener('click', ()=> openVideo(course));
        actions.prepend(vbtn);
      }

      // enroll button handler (example)
      card.querySelector('.enroll-btn').addEventListener('click', ()=>{
        course.students = (course.students || 0) + 1;
        course.progress = 5; // Start with 5% progress on enrollment
        saveCourses();
        renderAll(); // re-render to update students and progress
      });

      return card;
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, (m)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m])); }

    function getT(k){ return (T[uiLang.value] && T[uiLang.value][k]) || (T.en && T.en[k]) || k; }

    // render grid based on filters
    function renderAll(){
      coursesGrid.innerHTML = '';
      const level = filterLevel.value;
      const lang = filterLang.value;
      const filtered = courses.filter(c=>{
        if(level && c.level !== level) return false;
        if(lang && c.lang !== lang) return false;
        return true;
      });
      
      if (filtered.length === 0) {
        coursesGrid.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--muted);">
            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 16px;"></i>
            <h3>No courses match your filters</h3>
            <p>Try adjusting your filters or <button class="btn btn-primary small" id="reset-filters">reset them</button></p>
          </div>
        `;
        document.getElementById('reset-filters').addEventListener('click', () => {
          filterLevel.value = '';
          filterLang.value = '';
          renderAll();
        });
      } else {
        filtered.forEach(c => coursesGrid.appendChild(renderCard(c)));
      }
      
      updateCourseCount(filtered.length);
      // animate progress fills
      requestAnimationFrame(()=> {
        document.querySelectorAll('.progress-fill').forEach(el=>{
          const w = el.style.width||'0%';
          el.style.width='0%';
          setTimeout(()=> el.style.width = w, 40);
        });
      });
    }

    function updateCourseCount(n){
      const total = (typeof n === 'number') ? n : courses.length;
      coursesCount.textContent = `${total} ${getT('available_courses') || ''}`;
      yrSpan.textContent = new Date().getFullYear();
    }

    // video open
    function openVideo(course){
      // if video stored as base64
      if(course.video && course.video.isBase64){
        player.src = course.video.data;
      } else if(course.video && course.video.url){
        player.src = course.video.url;
      } else {
        alert('Video not available');
        return;
      }
      videoTitle.textContent = course.title;
      videoName.textContent = course.video.name || '';
      videoModal.classList.add('show');
      player.focus();
      player.play().catch(()=>{});
    }

    // close video modal
    closeVideo.addEventListener('click', ()=>{
      player.pause(); player.src=''; videoModal.classList.remove('show');
    });

    // open add modal
    openAddBtn.addEventListener('click', ()=> {
      modal.classList.add('show');
      document.getElementById('title').focus();
    });
    closeModalBtn.addEventListener('click', ()=> closeAdd());
    cancelBtn.addEventListener('click', ()=> closeAdd());
    window.addEventListener('click', (e)=> { 
      if(e.target === modal) closeAdd(); 
      if(e.target === videoModal) { 
        player.pause(); player.src=''; videoModal.classList.remove('show');
      }
    });

    // Close modals with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (modal.classList.contains('show')) closeAdd();
        if (videoModal.classList.contains('show')) {
          player.pause(); player.src=''; videoModal.classList.remove('show');
        }
      }
    });

    function closeAdd(){
      addForm.reset();
      pdfHelper.textContent = getT('no_file');
      videoHelper.textContent = getT('no_file');
      modal.classList.remove('show');
    }

    // file helpers
    pdfInput.addEventListener('change', ()=>{
      if(pdfInput.files.length) {
        pdfHelper.textContent = pdfInput.files[0].name;
        if (pdfInput.files[0].size > MAX_STORE_BYTES) {
          pdfHelper.textContent += ' (file is large, may not persist)';
        }
      }
      else pdfHelper.textContent = getT('no_file');
    });
    videoInput.addEventListener('change', ()=>{
      if(videoInput.files.length) {
        videoHelper.textContent = videoInput.files[0].name;
        if (videoInput.files[0].size > MAX_STORE_BYTES) {
          videoHelper.textContent += ' (file is large, may not persist)';
        }
      }
      else videoHelper.textContent = getT('no_file');
    });

    // add form submit
    addForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const submitBtn = addForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      
      try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner"></span> Adding...';
        
        const newCourse = {
          id: genId(),
          title: document.getElementById('title').value.trim(),
          desc: document.getElementById('desc').value.trim(),
          level: document.getElementById('level').value,
          lang: document.getElementById('lang').value,
          duration: Number(document.getElementById('duration').value) || 0,
          progress: 0,
          students: 0,
          pdf: null,
          video: null,
          createdAt: Date.now()
        };

        // handle pdf
        try{
          if(pdfInput.files.length){
            const f = pdfInput.files[0];
            // if small enough, store base64 in localStorage
            if(f.size <= MAX_STORE_BYTES){
              const b64 = await fileToBase64(f);
              newCourse.pdf = { isBase64:true, data:b64, name:f.name };
            }else{
              // large file: create temporary blob URL (not persisted on reload)
              const url = URL.createObjectURL(f);
              newCourse.pdf = { isBase64:false, url, name:f.name, persisted:false };
              console.warn('PDF too large to persist in localStorage; will use session blob URL only.');
            }
          }
        }catch(err){ console.warn('pdf read failed',err) }

        // handle video (same strategy)
        try{
          if(videoInput.files.length){
            const v = videoInput.files[0];
            if(v.size <= MAX_STORE_BYTES){
              const b64v = await fileToBase64(v);
              newCourse.video = { isBase64:true, data:b64v, name:v.name };
            }else{
              const url = URL.createObjectURL(v);
              newCourse.video = { isBase64:false, url, name:v.name, persisted:false };
              console.warn('Video too large to persist in localStorage; will use session blob URL only.');
            }
          }
        }catch(err){ console.warn('video read failed',err) }

        courses.unshift(newCourse);
        saveCourses();
        renderAll();
        closeAdd();
        alert(getT('add_course_success'));
      } catch (error) {
        console.error('Error adding course:', error);
        alert('Error adding course. Please try again.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // filters
    filterLevel.addEventListener('change', renderAll);
    filterLang.addEventListener('change', renderAll);
    clearFilters.addEventListener('click', ()=>{
      filterLevel.value = ''; filterLang.value='';
      renderAll();
    });

    // language changes
    uiLang.addEventListener('change', ()=> {
      applyTranslations(uiLang.value);
      renderAll();
    });

    // helper: set initial UI translations and load data
    (function init(){
      loadCourses();
      applyTranslations(uiLang.value);
      renderAll();
      yrSpan.textContent = new Date().getFullYear();
      // initial helpers
      pdfHelper.textContent = getT('no_file');
      videoHelper.textContent = getT('no_file');
      // make Explore button smooth scroll
      document.getElementById('explore-btn').addEventListener('click', ()=> {
        document.getElementById('courses').scrollIntoView({behavior:'smooth'});
      });
      
      // Set focus to skip link when Tab is pressed initially
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
          document.querySelector('.skip-link').style.display = 'block';
        }
      });
    })();

    // small safety: revoke blob URLs on unload to avoid leaks
    window.addEventListener('unload', ()=> {
      courses.forEach(c=>{
        if(c.pdf && !c.pdf.isBase64 && c.pdf.url) try{ URL.revokeObjectURL(c.pdf.url) }catch(e){}
        if(c.video && !c.video.isBase64 && c.video.url) try{ URL.revokeObjectURL(c.video.url) }catch(e){}
      });
    });

  })();
  
// Chatbot implementation
const chatWidget = document.getElementById("chatbot-widget");
const openChat = document.getElementById("open-chat");
const closeChat = document.getElementById("close-chat");
const sendBtn = document.getElementById("send-btn");
const chatBody = document.getElementById("chat-body");
const chatInput = document.getElementById("chat-input");
const voiceBtn = document.getElementById("voice-btn");

// Chatbot questions and responses
const chatbotResponses = {
  "progress": "Your overall progress is 68%. You're doing great! Keep up the consistent work.",
  "help": "I can help you with: checking your progress, finding resources, explaining concepts, and answering questions about your courses.",
  "resources": "You can find additional resources in the 'Resources' section of the platform. Is there a specific topic you need resources for?",
  "hello": "Hello! How can I help you with your learning today?",
  "thank": "You're welcome! Is there anything else I can help you with?",
  "default": "I'm not sure I understand. Could you rephrase that? I can help you with course content, progress tracking, and finding resources."
};

// Common questions quick replies
const quickReplies = [
  "What's my progress?",
  "Where can I find resources?",
  "Explain Week 2 Digital Literacy",
  "I need help with math"
];

openChat.onclick = () => {
  chatWidget.style.display = "flex";
  chatInput.focus();
};

closeChat.onclick = () => {
  chatWidget.style.display = "none";
  openChat.focus();
};

// Add message to chat
function addMessage(text, sender="bot") {
  const div = document.createElement("div");
  div.className = sender === "bot" ? "bot-msg" : "user-msg";
  div.textContent = text;
  chatBody.appendChild(div);
  chatBody.scrollTop = chatBody.scrollHeight;
}

// Generate bot response
function generateResponse(userInput) {
  userInput = userInput.toLowerCase().trim();
  
  if (userInput.includes("progress") || userInput.includes("how am i doing")) {
    return chatbotResponses["progress"];
  } else if (userInput.includes("help") || userInput.includes("what can you do")) {
    return chatbotResponses["help"];
  } else if (userInput.includes("resource") || userInput.includes("material")) {
    return chatbotResponses["resources"];
  } else if (userInput.includes("hello") || userInput.includes("hi") || userInput.includes("hey")) {
    return chatbotResponses["hello"];
  } else if (userInput.includes("thank")) {
    return chatbotResponses["thank"];
  } else if (userInput.includes("week 2") || userInput.includes("digital literacy")) {
    return "Week 2 of Digital Literacy covers internet safety and basic online research skills. Many students find the section on identifying reliable sources challenging. Would you like me to explain a specific concept?";
  } else if (userInput.includes("math") || userInput.includes("algebra") || userInput.includes("arithmetic")) {
    return "The Basic Mathematics course covers concepts from arithmetic to basic algebra. Many students struggle with fractions and percentages. Would you like practice problems on a specific topic?";
  } else {
    return chatbotResponses["default"];
  }
}

// Handle send
sendBtn.onclick = () => {
  const q = chatInput.value.trim();
  if(!q) return;
  addMessage(q, "user");
  chatInput.value = "";

  // Show typing indicator
  const typingIndicator = document.createElement("div");
  typingIndicator.className = "bot-msg";
  typingIndicator.innerHTML = "<span class='spinner'></span>";
  chatBody.appendChild(typingIndicator);
  chatBody.scrollTop = chatBody.scrollHeight;

  // Bot response after a short delay
  setTimeout(() => {
    chatBody.removeChild(typingIndicator);
    const response = generateResponse(q);
    addMessage(response);
    
    // Add quick replies for follow-up questions
    if (!q.includes("thank")) {
      setTimeout(() => {
        addMessage("Is there anything else you'd like to know?");
      }, 1000);
    }
  }, 1000);
};

// Send message on Enter key
chatInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    sendBtn.click();
  }
});

// Voice input
voiceBtn.onclick = () => {
  if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
    addMessage("Speech recognition is not supported in your browser. Try typing your question instead.");
    return;
  }
  
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-IN";
  recognition.start();
  
  voiceBtn.innerHTML = "<i class='fas fa-circle'></i>";
  voiceBtn.style.color = "#e74c3c";
  
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    chatInput.value = transcript;
    voiceBtn.innerHTML = "<i class='fas fa-microphone'></i>";
    voiceBtn.style.color = "";
  };
  
  recognition.onerror = () => {
    voiceBtn.innerHTML = "<i class='fas fa-microphone'></i>";
    voiceBtn.style.color = "";
  };
  
  recognition.onend = () => {
    voiceBtn.innerHTML = "<i class='fas fa-microphone'></i>";
    voiceBtn.style.color = "";
  };
};
  </script>
</body>
</html>

